<div class="center p-grid p-fluid" *ngIf="!view._message">
  <div class="p-col-12"><h2>No message selected</h2></div>
  <div class="p-col-12">Select a message from the list in order to view it!</div>
</div>
<div style="position: relative" *ngIf="view._message" class="main-container">
  <div class="p-fluid p-grid margin-bottom">
    <div class="col-12 flex max">
      <div class="subject">
        <h2>{{view._message?.Subject}}</h2>
      </div>
      <div class="star">
        <al-button (notify)="view._star()" icon="fa fa-star{{!view._message?.IsFlagged ? '-o' : ''}}"></al-button>
        <al-button (notify)="view._close()" icon="pi pi-times" styleClass="p-button-rounded p-button-outlined"></al-button>
      </div>
      <div class="close">
      </div>
    </div>
    <div class="col-12 flex max">
      <div class="avatar">
        <al-avatar [contact]="view._message | messageFrom"></al-avatar>
      </div>
      <div class="details">
        <div>{{view._message | messageFrom | messageFromTxt}} at {{view._message | messageDate}}</div>
        <div (click)="view._detailsHidden = !view._detailsHidden" class="extra">{{view._detailsHidden ? 'Show' : 'Hide'}} details</div>
        <div [hidden]="view._detailsHidden" class="extra-details">
          <ng-container [ngTemplateOutlet]="detailsTpl" [ngTemplateOutletContext]="{$implicit: 'From'}"></ng-container>
          <ng-container [ngTemplateOutlet]="detailsTpl" [ngTemplateOutletContext]="{$implicit: 'To'}"></ng-container>
          <ng-container [ngTemplateOutlet]="detailsTpl" [ngTemplateOutletContext]="{$implicit: 'Cc'}"></ng-container>
          <ng-template #detailsTpl let-field>
            <div [hidden]="!view._message[field]">{{field}}: 
              <span
                (click)="view._emailClick(contact)"
                class="contact-detail"
                *ngFor="let contact of (view._message[field] | contactsArray)"
                [innerHTML]="contact | messageFromTxtFull | asHtml"></span>
            </div>
          </ng-template>
        </div>
        <div [hidden]="!view._hasImages" class="img-options">
          <span (click)="view._showImages(false)"><i class="fa fa-picture-o"></i>&nbsp;Show images</span>
          <span (click)="view._showImages(true)" *ngIf="!view._contact?.IsTrusted"><i class="fa fa-picture-o"></i>&nbsp;Always show images</span>
        </div>
        <div [hidden]="!view._contact?.IsTrusted">
          <span (click)="view._untrust()"><i class="fa fa-minus-circle"></i>&nbsp;Don't show images</span>
        </div>
      </div>
      <div class="actions" #actions>
        <al-button label="Reply" *ngIf="!view._isDraft" icon="fa fa-reply" (notify)="view._action('reply')"></al-button>
        <al-button #menuButton *ngIf="!view._isDraft" icon="fa fa-angle-down" (notify)="menu.toggle($event)"></al-button>
        <!--p-slideMenu [appendTo]="actions" [model]="view._actions" [popup]="true"></p-slideMenu-->
        <!--p-splitButton *ngIf="!view._isDraft" label="Reply" icon="fa fa-reply" (onClick)="view._action('reply')" [model]="view._actions"></p-splitButton-->
        <i *ngIf="view._isDraft" (click)="view._action('from-draft')" class="fa fa-pencil"></i>
      </div>
    </div>
    <div class="attachments col-12" [hidden]="!view._message || (view._message | attachmentsList).length == 0">
      <al-attachments [attachments]="view._message | attachmentsList" [message]="view._message" [account]="view._account"></al-attachments>
    </div>
  </div>
  <pinch-zoom id="pinch" disableZoomControl="auto">
    <div class="message-body" style="{{view._maxWidth}}" [ngClass]="{'hide-quote': view._quotedText}" #messageBody [innerHTML]="view._html | asHtml"></div>
  </pinch-zoom>
  <div [hidden]="!view._quotedText">
    <div (click)="view._showHiddenContent()" class="extra">Show quoted text</div>
  </div>
</div>
<p-overlayPanel #menu styleClass="max-width" [appendTo]="menuButton">
  <ng-template pTemplate>
    <ng-container [ngTemplateOutlet]="buttonTpl" [ngTemplateOutletContext]="{$implicit: {icon: 'reply-all', label: 'Reply all'}}"></ng-container>
    <ng-container [ngTemplateOutlet]="buttonTpl" [ngTemplateOutletContext]="{$implicit: {icon: 'share', label: 'Forward', action: 'forward'}}"></ng-container>
    <ng-container [ngTemplateOutlet]="buttonTpl" [ngTemplateOutletContext]="{$implicit: {icon: 'download', label: 'Download'}}"></ng-container>
  </ng-template>
</p-overlayPanel>
<ng-template #buttonTpl let-context>
  <div class="p-col-12"><al-button icon="fa fa-{{context.icon}}" [label]="context.label" (notify)="view._action(context.action || context.icon)"></al-button></div>
</ng-template>
<ng-template #body>
</ng-template>
